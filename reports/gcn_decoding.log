Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/jupyter_cache/executors/utils.py", line 51, in single_nb_execution
    executenb(
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/client.py", line 1204, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/util.py", line 84, in wrapped
    return just_run(coro(*args, **kwargs))
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/util.py", line 62, in just_run
    return loop.run_until_complete(coro)
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/asyncio/base_events.py", line 616, in run_until_complete
    return future.result()
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/client.py", line 663, in async_execute
    await self.async_execute_cell(
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/client.py", line 965, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/nbclient/client.py", line 862, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
loss_fn = torch.nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(gcn.parameters(), lr=1e-4, weight_decay=5e-4)

epochs = 25
for t in range(epochs):
    print(f"Epoch {t+1}/{epochs}\n-------------------------------")
    train_loop(train_generator, gcn, loss_fn, optimizer)
    loss, correct = valid_test_loop(valid_generator, gcn, loss_fn)
    print(f"Valid metrics:\n\t avg_loss: {loss:>8f};\t avg_accuracy: {(100*correct):>0.1f}%")
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mRuntimeError[0m                              Traceback (most recent call last)
Cell [0;32mIn[11], line 7[0m
[1;32m      5[0m [38;5;28;01mfor[39;00m t [38;5;129;01min[39;00m [38;5;28mrange[39m(epochs):
[1;32m      6[0m     [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mEpoch [39m[38;5;132;01m{[39;00mt[38;5;241m+[39m[38;5;241m1[39m[38;5;132;01m}[39;00m[38;5;124m/[39m[38;5;132;01m{[39;00mepochs[38;5;132;01m}[39;00m[38;5;130;01m\n[39;00m[38;5;124m-------------------------------[39m[38;5;124m"[39m)
[0;32m----> 7[0m     [43mtrain_loop[49m[43m([49m[43mtrain_generator[49m[43m,[49m[43m [49m[43mgcn[49m[43m,[49m[43m [49m[43mloss_fn[49m[43m,[49m[43m [49m[43moptimizer[49m[43m)[49m
[1;32m      8[0m     loss, correct [38;5;241m=[39m valid_test_loop(valid_generator, gcn, loss_fn)
[1;32m      9[0m     [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mValid metrics:[39m[38;5;130;01m\n[39;00m[38;5;130;01m\t[39;00m[38;5;124m avg_loss: [39m[38;5;132;01m{[39;00mloss[38;5;132;01m:[39;00m[38;5;124m>8f[39m[38;5;132;01m}[39;00m[38;5;124m;[39m[38;5;130;01m\t[39;00m[38;5;124m avg_accuracy: [39m[38;5;132;01m{[39;00m([38;5;241m100[39m[38;5;241m*[39mcorrect)[38;5;132;01m:[39;00m[38;5;124m>0.1f[39m[38;5;132;01m}[39;00m[38;5;124m%[39m[38;5;124m"[39m)

Cell [0;32mIn[10], line 6[0m, in [0;36mtrain_loop[0;34m(dataloader, model, loss_fn, optimizer)[0m
[1;32m      2[0m size [38;5;241m=[39m [38;5;28mlen[39m(dataloader[38;5;241m.[39mdataset)    
[1;32m      4[0m [38;5;28;01mfor[39;00m batch, (X, y) [38;5;129;01min[39;00m [38;5;28menumerate[39m(dataloader):
[1;32m      5[0m     [38;5;66;03m# Compute prediction and loss[39;00m
[0;32m----> 6[0m     pred [38;5;241m=[39m [43mmodel[49m[43m([49m[43mX[49m[43m)[49m
[1;32m      7[0m     loss [38;5;241m=[39m loss_fn(pred, y)
[1;32m      9[0m     [38;5;66;03m# Backpropagation[39;00m

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch/nn/modules/module.py:1190[0m, in [0;36mModule._call_impl[0;34m(self, *input, **kwargs)[0m
[1;32m   1186[0m [38;5;66;03m# If we don't have any hooks, we want to skip the rest of the logic in[39;00m
[1;32m   1187[0m [38;5;66;03m# this function, and just call forward.[39;00m
[1;32m   1188[0m [38;5;28;01mif[39;00m [38;5;129;01mnot[39;00m ([38;5;28mself[39m[38;5;241m.[39m_backward_hooks [38;5;129;01mor[39;00m [38;5;28mself[39m[38;5;241m.[39m_forward_hooks [38;5;129;01mor[39;00m [38;5;28mself[39m[38;5;241m.[39m_forward_pre_hooks [38;5;129;01mor[39;00m _global_backward_hooks
[1;32m   1189[0m         [38;5;129;01mor[39;00m _global_forward_hooks [38;5;129;01mor[39;00m _global_forward_pre_hooks):
[0;32m-> 1190[0m     [38;5;28;01mreturn[39;00m [43mforward_call[49m[43m([49m[38;5;241;43m*[39;49m[38;5;28;43minput[39;49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m)[49m
[1;32m   1191[0m [38;5;66;03m# Do not call functions when jit is used[39;00m
[1;32m   1192[0m full_backward_hooks, non_full_backward_hooks [38;5;241m=[39m [], []

File [0;32m~/work/brain_encoding_decoding/brain_encoding_decoding/content/../src/gcn_model.py:36[0m, in [0;36mGCN.forward[0;34m(self, x)[0m
[1;32m     34[0m x [38;5;241m=[39m F[38;5;241m.[39mrelu(x)
[1;32m     35[0m x [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mdropout(x)
[0;32m---> 36[0m x [38;5;241m=[39m [43mtg[49m[38;5;241;43m.[39;49m[43mnn[49m[38;5;241;43m.[39;49m[43mglobal_mean_pool[49m[43m([49m
[1;32m     37[0m [43m    [49m[43mx[49m[43m,[49m[43m [49m[43mtorch[49m[38;5;241;43m.[39;49m[43mfrom_numpy[49m[43m([49m[43mnp[49m[38;5;241;43m.[39;49m[43marray[49m[43m([49m[38;5;28;43mrange[39;49m[43m([49m[43mx[49m[38;5;241;43m.[39;49m[43msize[49m[43m([49m[38;5;241;43m0[39;49m[43m)[49m[43m)[49m[43m,[49m[43m [49m[43mdtype[49m[38;5;241;43m=[39;49m[38;5;28;43mint[39;49m[43m)[49m[43m)[49m
[1;32m     38[0m [43m[49m[43m)[49m
[1;32m     39[0m x [38;5;241m=[39m x[38;5;241m.[39mview([38;5;241m-[39m[38;5;241m1[39m, [38;5;28mself[39m[38;5;241m.[39mn_roi [38;5;241m*[39m [38;5;28mself[39m[38;5;241m.[39mbatch_size)
[1;32m     40[0m x [38;5;241m=[39m [38;5;28mself[39m[38;5;241m.[39mfc1(x)

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch_geometric/nn/pool/glob.py:58[0m, in [0;36mglobal_mean_pool[0;34m(x, batch, size)[0m
[1;32m     56[0m     [38;5;28;01mreturn[39;00m x[38;5;241m.[39mmean(dim[38;5;241m=[39m[38;5;241m-[39m[38;5;241m2[39m, keepdim[38;5;241m=[39mx[38;5;241m.[39mdim() [38;5;241m==[39m [38;5;241m2[39m)
[1;32m     57[0m size [38;5;241m=[39m [38;5;28mint[39m(batch[38;5;241m.[39mmax()[38;5;241m.[39mitem() [38;5;241m+[39m [38;5;241m1[39m) [38;5;28;01mif[39;00m size [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;28;01melse[39;00m size
[0;32m---> 58[0m [38;5;28;01mreturn[39;00m [43mscatter[49m[43m([49m[43mx[49m[43m,[49m[43m [49m[43mbatch[49m[43m,[49m[43m [49m[43mdim[49m[38;5;241;43m=[39;49m[38;5;241;43m-[39;49m[38;5;241;43m2[39;49m[43m,[49m[43m [49m[43mdim_size[49m[38;5;241;43m=[39;49m[43msize[49m[43m,[49m[43m [49m[43mreduce[49m[38;5;241;43m=[39;49m[38;5;124;43m'[39;49m[38;5;124;43mmean[39;49m[38;5;124;43m'[39;49m[43m)[49m

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch_scatter/scatter.py:156[0m, in [0;36mscatter[0;34m(src, index, dim, out, dim_size, reduce)[0m
[1;32m    154[0m     [38;5;28;01mreturn[39;00m scatter_mul(src, index, dim, out, dim_size)
[1;32m    155[0m [38;5;28;01melif[39;00m reduce [38;5;241m==[39m [38;5;124m'[39m[38;5;124mmean[39m[38;5;124m'[39m:
[0;32m--> 156[0m     [38;5;28;01mreturn[39;00m [43mscatter_mean[49m[43m([49m[43msrc[49m[43m,[49m[43m [49m[43mindex[49m[43m,[49m[43m [49m[43mdim[49m[43m,[49m[43m [49m[43mout[49m[43m,[49m[43m [49m[43mdim_size[49m[43m)[49m
[1;32m    157[0m [38;5;28;01melif[39;00m reduce [38;5;241m==[39m [38;5;124m'[39m[38;5;124mmin[39m[38;5;124m'[39m:
[1;32m    158[0m     [38;5;28;01mreturn[39;00m scatter_min(src, index, dim, out, dim_size)[[38;5;241m0[39m]

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch_scatter/scatter.py:41[0m, in [0;36mscatter_mean[0;34m(src, index, dim, out, dim_size)[0m
[1;32m     38[0m [38;5;28;01mdef[39;00m [38;5;21mscatter_mean[39m(src: torch[38;5;241m.[39mTensor, index: torch[38;5;241m.[39mTensor, dim: [38;5;28mint[39m [38;5;241m=[39m [38;5;241m-[39m[38;5;241m1[39m,
[1;32m     39[0m                  out: Optional[torch[38;5;241m.[39mTensor] [38;5;241m=[39m [38;5;28;01mNone[39;00m,
[1;32m     40[0m                  dim_size: Optional[[38;5;28mint[39m] [38;5;241m=[39m [38;5;28;01mNone[39;00m) [38;5;241m-[39m[38;5;241m>[39m torch[38;5;241m.[39mTensor:
[0;32m---> 41[0m     out [38;5;241m=[39m [43mscatter_sum[49m[43m([49m[43msrc[49m[43m,[49m[43m [49m[43mindex[49m[43m,[49m[43m [49m[43mdim[49m[43m,[49m[43m [49m[43mout[49m[43m,[49m[43m [49m[43mdim_size[49m[43m)[49m
[1;32m     42[0m     dim_size [38;5;241m=[39m out[38;5;241m.[39msize(dim)
[1;32m     44[0m     index_dim [38;5;241m=[39m dim

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch_scatter/scatter.py:11[0m, in [0;36mscatter_sum[0;34m(src, index, dim, out, dim_size)[0m
[1;32m      8[0m [38;5;28;01mdef[39;00m [38;5;21mscatter_sum[39m(src: torch[38;5;241m.[39mTensor, index: torch[38;5;241m.[39mTensor, dim: [38;5;28mint[39m [38;5;241m=[39m [38;5;241m-[39m[38;5;241m1[39m,
[1;32m      9[0m                 out: Optional[torch[38;5;241m.[39mTensor] [38;5;241m=[39m [38;5;28;01mNone[39;00m,
[1;32m     10[0m                 dim_size: Optional[[38;5;28mint[39m] [38;5;241m=[39m [38;5;28;01mNone[39;00m) [38;5;241m-[39m[38;5;241m>[39m torch[38;5;241m.[39mTensor:
[0;32m---> 11[0m     index [38;5;241m=[39m [43mbroadcast[49m[43m([49m[43mindex[49m[43m,[49m[43m [49m[43msrc[49m[43m,[49m[43m [49m[43mdim[49m[43m)[49m
[1;32m     12[0m     [38;5;28;01mif[39;00m out [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m:
[1;32m     13[0m         size [38;5;241m=[39m [38;5;28mlist[39m(src[38;5;241m.[39msize())

File [0;32m/opt/hostedtoolcache/Python/3.8.15/x64/lib/python3.8/site-packages/torch_scatter/utils.py:12[0m, in [0;36mbroadcast[0;34m(src, other, dim)[0m
[1;32m     10[0m [38;5;28;01mfor[39;00m _ [38;5;129;01min[39;00m [38;5;28mrange[39m(src[38;5;241m.[39mdim(), other[38;5;241m.[39mdim()):
[1;32m     11[0m     src [38;5;241m=[39m src[38;5;241m.[39munsqueeze([38;5;241m-[39m[38;5;241m1[39m)
[0;32m---> 12[0m src [38;5;241m=[39m [43msrc[49m[38;5;241;43m.[39;49m[43mexpand[49m[43m([49m[43mother[49m[38;5;241;43m.[39;49m[43msize[49m[43m([49m[43m)[49m[43m)[49m
[1;32m     13[0m [38;5;28;01mreturn[39;00m src

[0;31mRuntimeError[0m: The expanded size of the tensor (675) must match the existing size (16) at non-singleton dimension 1.  Target sizes: [16, 675, 16].  Tensor sizes: [1, 16, 1]
RuntimeError: The expanded size of the tensor (675) must match the existing size (16) at non-singleton dimension 1.  Target sizes: [16, 675, 16].  Tensor sizes: [1, 16, 1]

